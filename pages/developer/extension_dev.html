---
layout: default
title: Developer Guide
description: AbanteCart Extension’s Developer Guide
tags: [
    ['architecture', 'AbanteCart Architecture']
]
redirect_from: "/tag/extension_dev.html"
---

<div class="category-info helper pt40">
	<h3 class="category-title">AbanteCart Extension’s Developer Guide</h3>
	<h4 class="category-description"> 
	</h4>
	<p>
	The extension subsystem of the AbanteCart is an essential part of shopping cart application. Extensions allow efficient way to add new features to the cart and allow scalability and flexibility of ecommerce application.
The extension subsystem of the AbanteCart allows shopping cart project grow indefinitely together with rapidly changing technologies, standards and techniques.<br>
Lots of effort lays on the development of the system and extensions to allow shopping cart administrators and owners smooth and worry free cart experience.<br>
Extension can be installed and managed in the control panel of AbanteCart. If you use market place to purchase extensions inside the control panel, extensions are downloaded and installed seamlessly without leaving your control panel and web browser. <br>
Our extension architecture is partially based on Plexus API concept (http://code.google.com/p/phpplexus/ ) and blend with our own concepts described below. 
	</p>
</div>

<div class="note js-note blue-light">
	<h4 class="note-title">Document Content</h4>
	<ul>
	<li class="toclevel-1 tocsection-1"><a href="#glossary"> <span class="toctext">Glossary</span></a></li>
	<li class="toclevel-1 tocsection-2"><a href="#basic"> <span class="toctext">Basic architecture and structure of the extension subsystem.</span></a></li>
	<li class="toclevel-1 tocsection-3"><a href="#files"> <span class="toctext">Files and directory structure</span></a></li>
	<li class="toclevel-1 tocsection-4"><a href="#configuration"> <span class="toctext">Extension configuration file</span></a></li>
	<li class="toclevel-1 tocsection-5"><a href="#validation"><span class="toctext">Settings Values Validation</span></a></li>
	<li class="toclevel-1 tocsection-6"><a href="#driver"><span class="toctext">Main driver file for extension</span></a></li>
	<li class="toclevel-1 tocsection-7"><a href="#install"><span class="toctext">Install or Uninstall scripts</span></a></li>
	<li class="toclevel-1 tocsection-8"><a href="#languages"><span class="toctext">Languages</span></a></li>
	<li class="toclevel-1 tocsection-9"><a href="#hooks"><span class="toctext">Hooks</span></a></li>
	<li class="toclevel-1 tocsection-10"><a href="#examples"><span class="toctext">Basic examples</span></a></li>
	<li class="toclevel-1 tocsection-11"><a href="#hooks-variable"><span class="toctext">Hooks Template Variables</span></a></li>
	<li class="toclevel-1 tocsection-12"><a href="#process"><span class="toctext">Extension Process flow</span></a></li>
	<li class="toclevel-1 tocsection-13"><a href="#additional"><span class="toctext">Additional scripts and styles for extensions</span></a></li>
	<li class="toclevel-1 tocsection-14"><a href="#rl"><span class="toctext">Resource Library</span></a></li>
	<li class="toclevel-1 tocsection-15"><a href="#rlexample"><span class="toctext">Example of extension that use resource library</span></a></li>
	<li class="toclevel-1 tocsection-16"><a href="#listingblock"><span class="toctext">Example of extension with listing block wrapper (appearance controller)</span></a></li>
	<li class="toclevel-1 tocsection-17"><a href="#package"><span class="toctext">Package extension for distribution</span></a></li>
	</ul>
</div>




<div class="category-info helper">
	<h4 id="glossary" class="box-title">Glossary</h4>
	<p class="box-description">
<b>Extension</b> &ndash;  Collection of  directories and files under one main directory  that can be added to shopping cart to offer additional feature or function.  Extension can be enabled and configured in the admin of shopping cart application<br>
<b>Extension Configuration</b> &ndash; Collection of settings that can control the extension functionality of behavior.  Configuration can be default (provided with the original installation of the extension) and custom, after installation once admin user change the settings.<br>
<b>Hook</b> &ndash; This is the tool used in extension subsystem to connect extension to particular section in application.<br>
<b>Core Hook</b> &ndash; This is the hook to the core function of application that allows extending functionality, effect data structures and values.
<b>Template Hook</b> -  This is the hook to extend display of the particular page on the front end or admin.  This is usually implemented within template file.<br>
<b>Dataset</b> - Ability to save, access and manage data specific for extension. See more details later on.
</p>
</div>






<div class="category-info helper">
	<h4 id="basic" class="box-title">Basic architecture and structure of the extension subsystem. </h4>
	<p class="box-description">
This paragraph to give you a generic idea about AbanteCart extension system and organization.<br>
AbanteCart architecture is designed around flexibility and expandability in mind. We believe that application architecture should provide sufficient flexibility to be able extended with new features and configured or adjusted to rapidly changing technology. To do so we introduce concept of fully extension based system and empower developers to create extensions for any new features or functionality.<br>
Extension can be installed and managed in the control panel of the AbanteCart. Marketplace is available to purchase, download and install extensions right in the control panel. In addition, any AbanteCart extension can be installed manually by simple upload of extension folder to AbanteCart and easy activation process.<br>
Extension itself is a collection of files that modify or add functionality of AbanteCart. Extension files include installation scripts, configuration settings, extension MVC file.<br>
Dependency concept is present to make sure that dependent extensions are installed to make extensions that depend on them work properly. 
Important stages in extension to understand:<br>
<b>Extension load:</b> This is the step of getting extension directory (content with files) in to the AbanteCart extensions directory. This is essential before step before you can install and use extension.<br>
<b>Extension Installation:</b>  This is a process of loading extension configuration to the system and making extension visible to the system. This stage does dependency validation and error checking. Install script provided in the extension is executed. Note: Installation is not to be confused with downloading extension or loading extension to the directory. This is done prior to installation. This step also allows you to edit extension configuration and settings.<br>
<b>Enable Extension:</b> This is a step to activate extension. Once extension is enabled it will be used by the system.
<b>Uninstall Extension:</b> It is important to understand this step. If you decide no longer to use given extension you can uninstall it. This step will completely remove all the settings and data used by the extension. Uninstall script provided in the extension is executed. Consider backup.<br>
<b>Delete Extension:</b> This is a step to remove extension components from the directory. Note: delete can only be done if extension is uninstalled.
</p>
</div>








<div class="category-info helper">
	<h4 id="files" class="box-title">Files and directory structure </h4>
	<p class="box-description">
All Extensions are located in <b>extensions</b> folder. Bellow is the set of files and directories  that represent one extension.<br></p>
<!-- File Tree -->
<div class="file-tree">
    <div class="file-tree-title"> AbanteCart Directory Structure
    	<ul class="file-tree-buttons">
    		<li class="js-expand">
    			<i class="fa fa-plus"></i> Expand all</li>
    		<li class="js-collapse">
    			<i class="fa fa-minus"></i> Collapse all</li>
    	</ul>
    </div>
    <ul class="file-tree-list js-file-tree" data-expanded="true">
    <li class="is-folder">extensions -
    	<span class="file-tree-description">All Extensions are located in extensions folder. 
    	<a href="https://github.com/abantecart/abantecart-src/tree/master/public_html/extensions" target="_github"><i class="fa fa-code fa-fw"></i></a>
    	</span>
    	<ul>
    	<li class="is-folder">[extension unique name] 
    		<span class="file-tree-description"> </span>
    		<ul>
    			<li class="is-file">config.xml -
    		<span class="file-tree-description">Required configuration xml file with settings for given extension.</span>
    </li>
    <li class="is-file">main.php -
    		<span class="file-tree-description">Required file that contain init instructions for extension.</span>
    </li>
    <li class="is-folder">admin -
    		<span class="file-tree-description">admin directory structure and contain files for admin section (directory structure under this directory resembles main admin directory for AbaneteCart)</span>
    	</li>
    <li class="is-folder">storefront -
    		<span class="file-tree-description">storefront directory structure and contain files for storefront section (directory structure under this directory resembles main storefront directory for AbaneteCart)</span>
    	</li>
    <li class="is-folder">core -
    		<span class="file-tree-description">directory that contain some core addon classes that implement additional functionality ( if needed )</span>
    	</li>
    <li class="is-file">install.sql -
    		<span class="file-tree-description">optional file that contain SQL instructions for extension install</span>
    	</li>
    <li class="is-file">uninstall.sql -
    		<span class="file-tree-description">optional file that contain SQL  instructions for extension uninstall</span>
    	</li>
    <li class="is-file">install.php -
    		<span class="file-tree-description">optional file that contain PHP code for extension installation proces.</span>
    	</li>
    <li class="is-file">uninstall.php -
    		<span class="file-tree-description">optional file that contain PHP code for extension uninstall process</span>
    	</li>
    		</ul>
    	</li>
    	</ul>
    </li>
    </ul>
</div>
						<!-- End of FIle Tree -->

						<div class="note js-note blue">
							<span class="note-close js-close">
								<i class="fa fa-times"></i>
							</span>
							<h4 class="note-title"> Note </h4>
							<p class="note-description"> you can use PHP or SQL or mixed depending on the requirents. </p>
						</div>
						<!-- End of Note -->



<p><img width="650" height="603" src="/img/developer/extensions.png" alt="Directory structure">
</p>

<p><b>Pre-install actions - validation</b><br>
Extensions are installed in control panel from Extension Manager section. Before installation there following checks are performed:
<ul><li> - check available space
</li><li> - is extensions directory writable
</li><li> - was extension already installed ( extension upgrade )
</li><li> - does extension support used core version
</li><li> - does hosting support all php modules used by extension
</li><li> - does extension override some controllers/ template files that already overridden by another extension. if two or more extensions override completely same files there will be a conflict, so high priority extension will be used. But, there will be warning in the install about conflict.
</li></ul></p>


<p><b>Post-install actions</b>
<ul><li> - check all files list and sizes
</li><li> - run install process
</li></ul>
</p>
</div>












<div class="category-info helper">
	<h4 id="configuration" class="box-title">Extension configuration file</h4>
	<p class="box-description">
Most of initial and default settings can be provided in configuration file. This files will be process on extension installation and configuration reset steps.
Bellow is the description of all items that are available in configuration file
</p>

<p><b>config.xml</b> example:
</p>


<!-- HTML Highlight -->
						<div class="code-highlight">
							<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;extension&gt;
  &lt;id&gt;discount&lt;/id&gt;
  &lt;version&gt;0.1.0&lt;/version&gt;
  &lt;cartversions&gt;
        	&lt;item&gt;1.0&lt;/item&gt;
  &lt;/cartversions&gt;
  &lt;phpmodules&gt;
        	 &lt;item&gt;curl&lt;/item&gt;
  &lt;/phpmodules&gt;
  &lt;layout&gt;&lt;/layout&gt;
  &lt;priority&gt;10&lt;/priority&gt;  
  &lt;type&gt;template&lt;/type&gt;
  &lt;category&gt;template&lt;/category&gt;
  &lt;dependencies&gt;
       &lt;item prior_version=&quot;0.9&quot; version=&quot;1.0&quot;&gt;slideshow&lt;/item&gt;
       &lt;item prior_version=&quot;0.9&quot; version=&quot;1.0&quot;&gt;product_slider&lt;/item&gt;
       &lt;item required=&quot;true&quot; prior_version=&quot;0.9&quot; version=&quot;1.0&quot;&gt;default_cod&lt;/item&gt;
  &lt;/dependencies&gt;
  &lt;settings&gt;
  	&lt;item id=&quot;discount_status&quot;&gt;
  	  	&lt;type&gt;selectbox&lt;/type&gt;
  	  	&lt;default_value&gt;0&lt;/default_value&gt;
  	  	&lt;variants&gt;
            &lt;item&gt;0&lt;/item&gt;
            &lt;item&gt;1&lt;/item&gt;
  	  	&lt;/variants&gt;
  	&lt;/item&gt;
  	&lt;item id=&quot;discount_percent&quot;&gt;
  	  	&lt;type&gt;input&lt;/type&gt;
  	  	&lt;default_value&gt;10&lt;/default_value&gt;
  	&lt;/item&gt;
  	&lt;item id=&quot;discount_message&quot;&gt;
  	  	&lt;type&gt;input&lt;/type&gt;
  	  	&lt;default_value&gt;We are pleased to annouce september discounts&lt;/default_value&gt;
        	&lt;/item&gt;
  	&lt;item id=&quot;discount_product_message&quot;&gt;
  	  	&lt;type&gt;input&lt;/type&gt;
  	  	&lt;default_value&gt;Old price: %s, You save: %s&lt;/default_value&gt;
  	&lt;/item&gt;
&lt;/settings&gt;   
&lt;additional_settings&gt;&lt;![CDATA[setting/setting&amp;active=store]]&gt;&lt;/additional_settings&gt;
&lt;note&gt;true&lt;/note&gt;
&lt;preview&gt;
    &lt;item&gt;preview.jpg&lt;/item&gt;
	&lt;item&gt;preview1.jpg&lt;/item&gt;
  &lt;item&gt;preview2.jpg&lt;/item&gt;
&lt;/preview&gt;
&lt;help_link&gt;&lt;![CDATA[http://google.com]]&gt;&lt;/help_link&gt;
&lt;install&gt;
  	 &lt;sql&gt;install.sql&lt;/sql&gt;
       &lt;trigger&gt;install.php&lt;/trigger&gt;
&lt;/install&gt;
&lt;uninstall&gt;
  	&lt;sql&gt;uninstall.sql&lt;/sql&gt;
  	&lt;trigger&gt;uninstall.php&lt;/trigger&gt;
&lt;/uninstall&gt;
&lt;/extension&gt;

 		</code>
 		</pre>
</div>
<!-- HTML Highlight -->


<p>
<b>More details about each extension config item</b>
</p><p><b>&lt;id&gt;discount&lt;/id&gt;</b> - extension unique named identifier ( should be unique among all other extensions )
</p><p><b>&lt;version&gt;0.1.0&lt;/version&gt;</b> - current extension version
</p><p><b>&lt;cartversions&gt;<br>&lt;item&gt;1.0&lt;/item&gt;<br>&lt;/cartversions&gt;</b>   - supported cart versions by the extension
</p><p><b>&lt;dependencies&gt;...&lt;/dependencies&gt;</b> - if given extension depends on other extension(s) be installed, this item can be used. See examples:
</p><p>Optional extension dependency.  original extension can work without dependant extension installed. ( use only 0.9 - 1.0 versions of extension )
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
&lt;dependencies&gt;
  	&lt;item prior_version=&quot;0.9&quot; version=&quot;1.0&quot;&gt;slideshow&lt;/item&gt; 
&lt;/dependencies&gt;
 	</code>
 	</pre>
</div>
<!-- HTML Highlight -->

<p>
Required extension. Current extension can not work without dependant extension installed.
</p>

<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
&lt;dependencies&gt;
&lt;item required=&quot;true&quot; prior_version=&quot;0.9&quot; version=&quot;1.0&quot;&gt;default_cod&lt;/item&gt; - extension.
&lt;/dependencies&gt;

&lt;phpmodules&gt; 
  	&lt;item&gt;gd&lt;/item&gt;
&lt;/phpmodules&gt; - Given extension depends on following php modules
 	</code>
 	</pre>
</div>
<!-- HTML Highlight -->



<p><b>&lt;priority&gt;10&lt;/priority&gt;</b> - Extension priority. This will set when current extension needs to be included and ran compare to other extensions installed.<br> 
Higher number will make extension with higher priority. 
</p><p><b>&lt;type&gt;template&lt;/type&gt;</b> - extension type. can be 'extensions', 'payment', 'shipping', 'template'. New types might be added in the future.
</p><p><b>&lt;category&gt;template&lt;/category&gt;</b> - extension category. This mostly used for grouping extensions and not used in AbanteCart itself. 
</p><p><b>&lt;settings&gt;.. &lt;/settings&gt;</b>  - contains extension settings<br>
See allowed settings types below. <br>
Example:
</p>


<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
 &lt;settings&gt;
       &lt;item id=&quot;discount_status&quot;&gt;
           &lt;type&gt;selectbox&lt;/type&gt;
           &lt;default_value&gt;0&lt;/default_value&gt;
           &lt;variants&gt;
               &lt;item&gt;0&lt;/item&gt;
               &lt;item&gt;1&lt;/item&gt;
           &lt;/variants&gt;
       &lt;/item&gt;
       &lt;item id=&quot;discount_percent&quot;&gt;
           &lt;type&gt;input&lt;/type&gt;
           &lt;default_value&gt;10&lt;/default_value&gt;
       &lt;/item&gt;
  &lt;/settings&gt;
  </code>
 	</pre>
</div>
<!-- HTML Highlight -->


<p>Starting from version 1.1.5 global settings have been implemented.  Now common settings such as status, sort_order etc. are not required to be included. <br> 
If common settings are still included in given extension configuration file, they will override global settings.<br>  
If global setting is not needed, it can be disabled with adding &lt;disabled&gt;true&lt;/disabled&gt;<br> 
Example:
</p>


<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
&lt;item id=&quot;payment_minimum_total&quot;&gt;
			&lt;disabled&gt;true&lt;/disabled&gt;
&lt;/item&gt; 	</code>
 	</pre>
</div>
<!-- HTML Highlight -->

<p>Global settings are located in core/extension/ directory and attached to top or bottom of the settings page. <br> 
Global settings available for any extension (default section) and for extension type as well, such as shipping and payment. <br> 
</p><p><br>
<b>&lt;additional_settings&gt;...&lt;/additional_settings&gt;</b> - you can add link to additional extension settings. It could be controller inside extension or any existing admin controller. By default button title will be ‘Additional Settings’. If you want to change it - you should add language definition with key = ‘text_additional_settings’ to your language file - it will define button title<br>
Example:
</p>


<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
&lt;additional_settings&gt;&lt;![CDATA[setting/setting&amp;active=store]]
&gt;&lt;/additional_settings&gt;</code>
 	</pre>
</div>
<!-- HTML Highlight -->

<p><br>
<b>&lt;note&gt;true&lt;/note&gt;</b> - define if extensions have notes or not. notes defined in language file with key = ‘&lt;extension_name&gt;_note’. note will be shown on extension edit page. This note can help with additional information to users how to manage extension or extra steps to set up extension. 
</p><p><b>&lt;preview&gt;...&lt;/preview&gt;</b> - extension preview images. stored in <i>[extension_id]/image/</i> folder<br>
Example:
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
&lt;preview&gt;
&lt;item&gt;preview.jpg&lt;/item&gt;
&lt;item&gt;preview1.jpg&lt;/item&gt;
&lt;item&gt;preview2.jpg&lt;/item&gt;
&lt;/preview&gt;</code>
 	</pre>
</div>
<!-- HTML Highlight -->
<p><br>
<b>&lt;help_link&gt;&lt;![CDATA<a href="http://www.google.com" class="external autonumber" rel="nofollow">[1]</a>]&gt;&lt;/help_link&gt;</b> - define help page link. if not empty - you will have help button on extension edit page. This can be external link.
</p><p>Install and removal items:
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
&lt;install&gt;
        &lt;sql&gt;install.sql&lt;/sql&gt; - sql queries run on install
       &lt;trigger&gt;install.php&lt;/trigger&gt; - php code run on install
&lt;/install&gt;
&lt;uninstall&gt;
	    	&lt;sql&gt;uninstall.sql&lt;/sql&gt; - sql queries run on uninstall
&lt;trigger&gt;uninstall.php&lt;/trigger&gt; - php code run on uninstall
&lt;/uninstall&gt;</code>
 	</pre>
</div>
<!-- HTML Highlight -->
<p><b>AbanteCart extension support following settings types:</b>
</p>
<ul><li> hidden
</li><li> input
</li><li> password
</li><li> textarea
</li><li> selectbox
</li><li> multiselect
</li><li> checkbox
</li><li> checkbox group
</li><li> file
</li><li> radio
</li></ul>


</div>

















<div class="category-info helper">
	<h4 id="validation" class="box-title">Settings Values Validation (Starting v1.1.4)</h4>
	<p class="box-description">
In some cases there is a need to validate settings values provided by user. It is a developers responsobility to maintain stability of extension and AbanteCart core as a result of extension functionality. For this reason important to validate settings not only for required fields, but also for actual values and allowed value types. 
Validation is possible with 2 methods. 
</p>
<pre>1. Pattern (regular expressions) based validation  
2. Code side validation in custom function  
</pre>
<h3> <span class="mw-headline" id="Pattern_based_validation">  Pattern based validation </span></h3>
<p>This is a quick way to set validation to given setting field.  Regular expression can be set per each setting filed  to allow only specified value in the field. 
</p><p>Example of email validation:
</p>

<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
    &lt;item id=&quot;email&quot;&gt;
		&lt;type&gt;input&lt;/type&gt;
		&lt;default_value&gt;&lt;/default_value&gt;
		&lt;pattern_validate&gt;/^[a-zA-Z0-9_\-.]+@[a-zA-Z0-9\-]+\.[a-zA-Z0-9\-.]+$/&lt;/pattern_validate&gt;
    &lt;/item&gt;
</code>
 	</pre>
</div>
<!-- HTML Highlight -->





<p>Note: Error text needs to be added to language XML with key like this: [extention_id]_[item_id]_validation_error or [extention_id]_email_validation_error in example above.
</p>
<h3> <span class="mw-headline" id="Code_side_validation">  Code side validation </span></h3>
<p>In case more advanced settings values validation required, you need to provide your own code to validate input and generate errors. 
This is done in a special validate.php file included on the main extension directory level. This file will be automatically included 
Function inside the file have to be named settingsValidation () { …
</p><p>Example:
</p>


<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
function settingsValidation ( $settings_data = array()) {
    $error_items = array(); // array with failed validation data keys
  
    foreach($settings_data as $item_id=&gt;$item_value){
        if( !isset($item_value)){
            $error_items[$item_id] = $language-&gt;get(&#39;errot_text_key&#39;) ;
        }
    }
    if ($error_items) {
        return array( &#39;result&#39; =&gt; false,
                      &#39;errors&#39; =&gt; $error_items);
    }
    return array(&#39;result&#39;=&gt;true);
}</code>
 	</pre>
</div>
<!-- HTML Highlight -->

<p>Input: 
settingsValidation function will get an array with settings and values submitted by user. 
</p><p>Example of input array:
</p>

<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
array (
 &#39;store_id&#39; =&gt; &#39;0&#39;,
 &#39;google_checkout_advanced_status&#39; =&gt; &#39;1&#39;,
 &#39;google_checkout_advanced_merchant_id&#39; =&gt; &#39;11111111111111111111&#39;,
 &#39;google_checkout_advanced_merchant_key&#39; =&gt; &#39;dfjsdljadsfkjsdfklsdjfksdl&#39;,
 &#39;google_checkout_advanced_currency&#39; =&gt; &#39;USD&#39;,
 &#39;google_checkout_advanced_total&#39; =&gt; &#39;0&#39;,
 &#39;google_checkout_advanced_test&#39; =&gt; &#39;1&#39;,
 &#39;google_checkout_advanced_merchant_calculation&#39; =&gt; &#39;1&#39;,
 &#39;google_checkout_advanced_order_status_id&#39; =&gt; &#39;1&#39;,
 &#39;google_checkout_advanced_location_id&#39; =&gt; &#39;0&#39;,
 &#39;google_checkout_advanced_sort_order&#39; =&gt; &#39;0&#39;,
)
</code>
 	</pre>
</div>
<!-- HTML Highlight -->

<p>NOTE: settingsValidation function will be call in all settings save and individual (quick) save. Keep in mind that validation needs to be done on each field separately. 
Required values handled by core and  required="true"  setting in the config
</p><p>Return:
return needs to be array with result =  true/false and error message for each field with failed validation.
</p><p>If validation passed
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
array( &#39;result&#39;=&gt;true );
</code>
 	</pre>
</div>
<!-- HTML Highlight -->
<p>or if failed
</p>


<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
array( &#39;result&#39;=&gt;false , &#39;errors&#39; =&gt; array( &#39;field_name&#39; =&gt; &#39;Missing Name&#39; ) );	
 	</code>
 	</pre>
</div>
<!-- HTML Highlight -->


</div>












<div class="category-info helper">
	<h4 id="driver" class="box-title">Main driver file for extension</h4>
	<p class="box-description">
This is a main file that gets processed every time extension is loaded.  It is used to include files used by given extension, define extension resources and do other initial routines.<br>
There are 4 types of resources that extension can use
</p>
<ul><li> controllers
</li><li> languages
</li><li> models
</li><li> template files
</li></ul>
<p>Each resource can be in 2 sections – admin &amp; storefront.
</p><p>Controllers, languages and models defined as <b>catalog/product</b><br>
Templates defined with <b>.tpl</b> extension – <b>catalog/product.tpl</b>
</p><p>Example:
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-php">
&lt;?php
if ( !defined ( &#39;DIR_CORE&#39; )) {
	header ( &#39;Location: static_pages/&#39; );
}
include(&#39;core/template2.php&#39;);
include(&#39;core/template2_pagination.php&#39;);
 
$languages = array(
  	&#39;storefront&#39; =&gt; array(
	  &#39;template2/template2&#39;,
  	),
  	&#39;admin&#39; =&gt; array(
	    	&#39;template2/template2&#39;,
  	),
);
$templates = array(
  	&#39;storefront&#39; =&gt; array(
	  &#39;common/head.tpl&#39;,
	  &#39;common/header.tpl&#39;,
	  &#39;common/footer.tpl&#39;,
  	),
  	&#39;admin&#39; =&gt; array(),
);
?&gt;

 	</code>
 	</pre>
</div>
<!-- HTML Highlight -->


</p>
</div>










<div class="category-info helper">
	<h4 id="install" class="box-title">Install or Uninstall scripts</h4>
	<p class="box-description">
	There are 2 types of install or removal scripts that can be used. SQL and PHP.<br>
SQL needs to have SQL commands that will be executed on extension install or uninstall respectivly.<br>
PHP can have code that will be executed during extension install and removal process. PHP files can include all the methods and classes available in the AbanteCart.<br>
<b>IMPORTANT:</b> Be very careful with updating database and altering tables. Please account for data integrity. If update existing table, account for speed of SQL execution in case of large data in the tables you effect. If uninstall, be careful with data removal. Do not delete altered fields and drop tables that are not created by given extension.<br> 
Consider validation for data if you do multiple SQL insert or updates that depends on each other. 
	</p>
</div>









<div class="category-info helper">
	<h4 id="languages" class="box-title">Languages</h4>
	<p class="box-description">
	Each extension needs to have it own language files that it is using for text variables.<br>
Extension needs to include all the language that it supports.<br>
<b>IMPORTANT:</b> Please use translation (language based variables) for all the text you use.<br>
This will help everybody and users can edit translation in the control panel if needed. <br>
Refer to languages in developer’s manual.
	</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;definitions&gt;
 &lt;definition&gt;
   &lt;key&gt;discount_name&lt;/key&gt;  - [extension]_name - will be output as an extension name
   &lt;value&gt;&lt;![CDATA[Discount on all products]]&gt;&lt;/value&gt;
 &lt;/definition&gt;
 &lt;definition&gt;
   &lt;key&gt;discount_description&lt;/key&gt;  - [extension]_name - will be output as an extension description
   &lt;value&gt;&lt;![CDATA[discount products extension]]&gt;&lt;/value&gt;
 &lt;/definition&gt;
 &lt;definition&gt;
   &lt;key&gt;discount_percent&lt;/key&gt; - translation for settings item
   &lt;value&gt;&lt;![CDATA[Discount percent]]&gt;&lt;/value&gt;
 &lt;/definition&gt;
 &lt;definition&gt;
   &lt;key&gt;discount_status&lt;/key&gt; - translation for settings item
   &lt;value&gt;&lt;![CDATA[Status]]&gt;&lt;/value&gt;
 &lt;/definition&gt;
 &lt;definition&gt;
   &lt;key&gt;discount_status_0&lt;/key&gt;  - translation for settings item variant ( in format [item_id][variant_value] - [discount_status][0] )
   &lt;value&gt;&lt;![CDATA[Disabled]]&gt;&lt;/value&gt;
 &lt;/definition&gt;
 &lt;definition&gt;
   &lt;key&gt;discount_status_1&lt;/key&gt;
   &lt;value&gt;&lt;![CDATA[Enabled]]&gt;&lt;/value&gt;
 &lt;/definition&gt;
&lt;/definitions&gt;
 	</code>
 	</pre>
</div>
<!-- HTML Highlight -->
</div>














<div class="category-info helper">
	<h4 id="hooks" class="box-title">Hooks</h4>
	<p class="box-description">
	In order to control data structures, functions, flow and views AbanteCart utilize hooks placed in various parts of the code in core, storefront and admin.  Each hook will have unique name.<br>
To call a hook you must use <i>extensions api</i> object. It is stored in registry as an <b>extensions</b> and since all classes can use registry properties as their own you can use <b>$this-&gt;extensions</b>
To have an extensions api hook an object of class “ClassName” method call, you do:
	</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
$this-&gt;extensions-&gt;hkMethodName($object, $param1, $param2);
 	</code>
 	</pre>
</div>
<!-- HTML Highlight -->



<p>Basically, when you tell the extensions api to hook ClassName::methodName(), it creates Extension hooks and calls them and the main method as follows (this is not always true and it is more complicated than this, but it is better to express more precise wiring in visual form):
</p>
<ul><li> <b>Extension::beforeClassNameMethodName()</b> - use it to update/change parameters passed to method
</li><li> <b>Extension::aroundClassNameMethodName()</b> - use it to forbid original method call
</li><li> <b>ClassName::methodName()</b>
</li><li> <b>Extension::onClassNameMethodName()</b> - use it to change return data
</li><li> <b>Extension::afterClassNameMethodName()</b> - use it to run some functions after method is executed
</li></ul>
<p><a href="/document_wiki/index.php/Extension_FlowChart" title="Extension FlowChart">Extension_FlowChart</a> 
</p><p>Some of the hooks may seem very similar, but they help to serve different purposes.
</p><p>Extension automatically has access to the current controller object (class instance) loaded during the hooking process. Current controller instance used in the extension class will be available via <b>$this-&gt;baseObject</b> and provides access to all public methods and properties in the extended controller. This also includes access to global structures. Refer to developer’s manual for global data structures and controller public methods and properties.<br>
NOTE: The state of extended controller instance can be different depending on the hook location and stage of execution.
</p><p>Example of extension class:
</p>



<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
class ExtensionName extends Extension {
   public function onClassNameMethodName($param1, $param2) {
   	if ($this-&gt;baseObject-&gt;property === true) {
       	// ... let&#39;s do something now ...
   	}
   }
}
</code>
 	</pre>
</div>
<!-- HTML Highlight -->



<p><b>NOTE:</b> all class properties you want to be used in extensions must be declared as <b>public</b>
</p><p>Extensions also have the current ExtensionsApi loaded into them so that they can make hookable calls on other objects if needed, such as the base object or another object:
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
class ExtensionName extends Extension { 
            	public function beforeClassNameMethodName($param1, $param2)
            	{
   	// ...
   	$object = new AnotherClass();
   	// ...
       $this-&gt;ExtensionsApi-&gt;hkAnotherMethod($object, &#39;this is input param 1&#39;);
            	}
            	public function afterClassNameMethodName($param1, $param2) {
   	// ...
       $this-&gt;ExtensionsApi-&gt;hkAnotherMethod($this-&gt;baseObject);
            	}
}
 	</code>
 	</pre>
</div>
<!-- HTML Highlight -->





<p>Extensions can even have calls to themselves hooked. You could use the Extension’s ExtensionsApi to accomplish this just as with other objects; however, if you are not overriding the Extension __call() method, there is an easier way:
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
class ExtensionName extends Extension {
            	public function afterClassNameMethodName($param1, $param2) {
   	// hook $this-&gt;performSomeAction()
   	$this-&gt;hkPerformSomeAction();
   }
   public function performSomeAction() {
   	// ...
   }
}
 	</code>
 	</pre>
</div>
<!-- HTML Highlight -->




<p>When it is a Extension that is being hooked, the base object is not changed. This is usually the desired functionallity, but may not always be. However, if one Extension wants to access another Extension, it can do so through its Extension Api:
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
class AnotherExtensionName extends Extension {
   public function onExtensionNamePerformSomeAction() {
   	$Extension = $this-&gt;ExtensionsApi-&gt;ExtensionName;
   	// ... do something with the other Extension now
   }
}
</code>
 	</pre>
</div>
<!-- HTML Highlight -->




<p>Extension can be called on any hook method called. You need to use <b>overload Hooks</b> property for it
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
class ExtensionDefaultExtensionLogger extends Extension {
            	public $overloadHooks = true;
            	protected $log = &#39;&#39;;
            	protected function log($message) {
                           	$this-&gt;log .= &#39;[&#39; . date(&#39;Y-m-d H:i:s&#39;) . &quot;] $message\n&quot;;
            	}
 
            	public function __call($method, $args) {
                           	$this-&gt;log(&quot;called Extension::$method()&quot;);
            	}
            	public function printLog() {
                           	echo &#39;&lt;strong&gt;Extension Call Log&lt;/strong&gt;&lt;pre&gt;&#39;, $this-&gt;log, &#39;&lt;/ pre&gt;&#39;;
            	}
}</code>
 	</pre>
</div>
<!-- HTML Highlight -->


</div>

















<div class="category-info helper">
	<h4 id="examples" class="box-title">Basic examples</h4>
	<p class="box-description">
You need to control Controller <b>data</b> property to change data that passed to template file . We will place hooks in two places
</p>
<ul><li> in the very beginning of  method  - to init some data
</li><li> before call to <b>$this-&gt;render()</b> to update data
</li></ul>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
// in the beginning of file
//use to init controller data
$this-&gt;extensions-&gt;hk_InitData($this);
.....
//some code
.....
//use to update controller data
$this-&gt;extensions-&gt;hk_UpdateData($this);

// an extension that use these hooks could look like this
&lt;?php
class ExtensionName extends Extension {	
 
   public function onClassNameMethodName_InitData()
   {  
   	// add message variable
   	$this-&gt;baseObject-&gt;data[&#39;message&#39;] = $message;
   }
 
   public function onClassNameMethodName_UpdateData()
   {  
   	// update message variable
   	$this-&gt;baseObject-&gt;data[&#39;message&#39;] = ucfirst($message);
   }
}
 	</code>
 	</pre>
</div>
<!-- HTML Highlight -->

           	
<p>If you need to create a hook for some method of a class, for example you need to hook to Cart::getProducts method
you can do following:
</p>
<ul><li> you can update all <b>$this-&gt;cart-&gt;getProducts</b> calls to <b>$this-&gt;extensions-&gt;hkgetProducts($cart);</b>
</li><li> or you can change original function
</li></ul>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
//first change original function
public function getProducts() {
   	$registry = Registry::getInstance();
   	// call extensions api
   	return $registry-&gt;get(&#39;extensions&#39;)-&gt;hk_getProducts($this);
   }
 
// rename the original function, now it will be called
// by extensions api if not overrided
public function _getProducts() {}
 
and call function as
$this-&gt;extensions-&gt;hk_getProducts();</code>
 	</pre>
</div>
<!-- HTML Highlight -->



</div>






<div class="category-info helper">
	<h4 id="hooks-variable" class="box-title">Hooks Template Variables</h4>
	<p class="box-description">
	In order to add new data (HTML or just text) to template (.tpl) files from extension AbanteCart allows hook template variables that are placed in .tpl files as regular PHP variables. <br>
Template Hook Variables look like this:  <b>&lt;?php echo $this-&gt;getHookVar('hook_name');&nbsp;?&gt;</b><br>
These Template Hook Variables can be used in the extension. To add variable use <b>$this-&gt;view&gt;addHookVar()</b> method. 
To locate appropriate template hook variable look into the template file, where you want to add values too. <br>
Example:  
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-php">
// an extension that access  and modify template hook variables:
&lt;?php
class ExtensionName extends Extension {	
   public function onClassNameMethodName_UpdateData()
   {     	
	// Set new value with appending  new data to $hook_message
	$this-&gt;baseObject-&gt;view-&gt;addHookVar(&#39;hook_message&#39;, &#39;Confirmation Massage&#39;);
   }
 
 }</code>
 	</pre>
</div>
<!-- HTML Highlight -->
<p><b>Help:</b> Can not add or change values in the base template file or controller? No Problem. Contact us in a forum.abantecart.com  and we will help to find solution. If you discover that you need to add something to base template files in AbanteCart storefront or admin, and there is no way to do this or no hook variable available let us know. We can add hooks to current development version and next release. 
</p>
	

</div>












<div class="category-info helper">
	<h4 id="process" class="box-title">Extension Process flow:</h4>
	<p class="box-description">
	Once AbanteCart page/response load starts (init.php), all enabled extensions are loaded.  At this time system has created instances of all extensions classes that responsible for hooks processing.<br>
Control passed to Action class which is trying to define controller and method based on route variable. It checks if first part of route is an extension name and if it is, tries to load it.<br>
Controller is loaded, it's method is executed and it is ready to render template. System is looking for template file.
</p>
<ul><li> first it looks for an override file - it will be named as <b>template.override.tpl</b> - any extensions can override template file. But if several extensions tries to override one file, file from extension with higher priority will be used.
</li><li> if override is not found it is looking for <b>template.pre.tpl</b> and <b>template.post.tpl</b> - their content added before and after original template - any extensions can use <b>pre</b> and <b>post</b> files.  if several extensions contain <b>pre</b> or <b>post</b>  files - they all will be rendered according to extension priority
</li><li> at last it is looking for <b>template.tpl</b>
</li></ul>
<p><br>
<b>How to develop Extensions:</b>
Let us show how to develop extension based on the example that will apply discount on all products
</p><p>Extension unique id name will be - <b>discount</b>
</p>
<ul><li> create directory <b>../extensions/discount</b>
</li><li> create config file  <b>../extensions/discount/config.xml</b>
</li></ul>
<p>At minimum we need to add following settings<br>
1. discount_status - enabled/disabled
2. discount_percent - percent of discount
3. discount message - message that will be shown on cart page
4. discount message for every product - how much you save
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;extension&gt;
   &lt;id&gt;discount&lt;/id&gt;
   &lt;version&gt;0.1.0&lt;/version&gt;
   &lt;cartversions&gt;
        &lt;item&gt;0.9&lt;/item&gt;
        &lt;item&gt;1.0&lt;/item&gt;
    &lt;/cartversions&gt;
   &lt;dependencies&gt;&lt;/dependencies&gt;
   &lt;phpmodules&gt;&lt;/phpmodules&gt;
   &lt;layout&gt;&lt;/layout&gt;
   &lt;priority&gt;10&lt;/priority&gt;  
   &lt;type&gt;extensions&lt;/type&gt;
   &lt; category&gt;discount&lt;/ category&gt;
   &lt;settings&gt;
 &lt;item id=&quot;discount_status&quot;&gt;
            &lt;type&gt;checkbox&lt;/type&gt;
            &lt;default_value&gt;0&lt;/default_value&gt;
   	&lt;/item&gt;
       &lt;item id=&quot;discount_percent&quot;&gt;
           &lt;type&gt;input&lt;/type&gt;
           &lt;default_value&gt;10&lt;/default_value&gt;
       &lt;/item&gt;
       &lt;item id=&quot;discount_message&quot;&gt;
           &lt;type&gt;input&lt;/type&gt;
           &lt;default_value&gt;We are pleased to annouce september discounts&lt;/default_value&gt;
       &lt;/item&gt;
       &lt;item id=&quot;discount_product_message&quot;&gt;
           &lt;type&gt;input&lt;/type&gt;
           &lt;default_value&gt;Old price: %s, You save: %s&lt;/default_value&gt;
       &lt;/item&gt;
   &lt;/settings&gt;	
&lt;/extension&gt;</code>
 	</pre>
</div>
<!-- HTML Highlight -->

<p>
- create main driver PHP file <b>../extensions/discount/main.php</b>
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-php">
&lt;?php
include(&#39;core/discount.php&#39;);
&lt;?php
if ( !defined ( &#39;DIR_CORE&#39; )) {
	header ( &#39;Location: static_pages/&#39; );
}
 
$languages = array(
  	&#39;admin&#39; =&gt; array(
	  &#39;discount/discount&#39;
  	),
  	&#39;storefront&#39; =&gt; array(),
);
 
$templates = array(
  	&#39;admin&#39; =&gt; array(),
  	&#39;storefront&#39; =&gt; array(
        	&#39;pages/checkout/cart.tpl&#39;
  	),
);
</code>
 	</pre>
</div>
<!-- HTML Highlight -->


<p>
- create language setting file <b>../extensions/discount/admin/language/english/discount/discount.xml</b>
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;definitions&gt;
 &lt;definition&gt;
   &lt;key&gt;discount_name&lt;/key&gt;
   &lt;value&gt;&lt;![CDATA[Discount extension]]&gt;&lt;/value&gt;
 &lt;/definition&gt;
 &lt;definition&gt;
   &lt;key&gt;discount_description&lt;/key&gt;
   &lt;value&gt;&lt;![CDATA[discount products extension]]&gt;&lt;/value&gt;
 &lt;/definition&gt;
 &lt;definition&gt;
   &lt;key&gt;discount_percent&lt;/key&gt;
   &lt;value&gt;&lt;![CDATA[Discount percent]]&gt;&lt;/value&gt;
 &lt;/definition&gt;
 &lt;definition&gt;
   &lt;key&gt;discount_message&lt;/key&gt;
   &lt;value&gt;&lt;![CDATA[Discount message]]&gt;&lt;/value&gt;
 &lt;/definition&gt;
 &lt;definition&gt;
   &lt;key&gt;discount_product_message&lt;/key&gt;
   &lt;value&gt;&lt;![CDATA[Product message]]&gt;&lt;/value&gt;
 &lt;/definition&gt;
 &lt;definition&gt;
   &lt;key&gt;discount_status&lt;/key&gt;
   &lt;value&gt;&lt;![CDATA[Status]]&gt;&lt;/value&gt;
 &lt;/definition&gt;
 &lt;definition&gt;
   &lt;key&gt;discount_status_0&lt;/key&gt;
   &lt;value&gt;&lt;![CDATA[Disabled]]&gt;&lt;/value&gt;
 &lt;/definition&gt;
 &lt;definition&gt;
   &lt;key&gt;discount_status_1&lt;/key&gt;
   &lt;value&gt;&lt;![CDATA[Enabled]]&gt;&lt;/value&gt;
 &lt;/definition&gt;
&lt;/definitions&gt;
 	</code>
 	</pre>
</div>
<!-- HTML Highlight -->



<p>- create extension class to handle the work: <b>../extensions/discount/core/discount.php</b>
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-php">
&lt;?php
class ExtensionDiscount extends Extension {
   protected $registry;
   public function  __construct() {
   	$this-&gt;registry = Registry::getInstance();
   }
 
}
</code>
 	</pre>
</div>
<!-- HTML Highlight -->	



<p>- add a message about discounts to CheckoutCart step/page
1. Edit file add this function below:<br>
<b>../extensions/discount/core/discount.php</b>
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-php">
public function onControllerPagesCheckoutCart_InitData() {  
$discount_message = $this-&gt;registry-&gt;get(&#39;config&#39;)-&gt;get(&#39;discount_message&#39;); 	
	$this-&gt;baseObject-&gt;view-&gt;addHookVar(&#39;additional_message&#39;, $discount_message);
 } 	</code>
 	</pre>
</div>
<!-- HTML Highlight -->



<p>2. Extension will need to override default cart template to add discount message
copy<br>
storefront/view/default/template/pages/checkout/cart.tpl<br>
to<br>
extensions/discount/storefront/view/default/template/pages/checkout/
</p><p>edit <b>cart.tpl</b>
</p><p>find
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-php">
&lt;?php if ($error_warning) { ?&gt;
	&lt;div class=&quot;warning&quot;&gt;&lt;?php echo $error_warning; ?&gt;&lt;/div&gt;
&lt;?php } ?&gt;</code>
 	</pre>
</div>
<!-- HTML Highlight -->

<p>Insert after it
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-php">
&lt;?php echo $this-&gt;getHookVar(&#39;additional_message&#39;); ?&gt;</code>
 	</pre>
</div>
<!-- HTML Highlight -->
	



<p>- now lets apply a discount to each product in cart
1. edit <b>core\lib\cart.php</b>
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-php">
// change original function to support hooks
public function getProducts() {
   $registry = Registry::getInstance();
   return $registry-&gt;get(&#39;extensions&#39;)-&gt;do_getProducts($this);
}
 
// rename original function   	
public function _getProducts() {
</code>
 	</pre>
</div>
<!-- HTML Highlight -->	




<p>2. edit <b>extensions\discount\core\discount.php</b>
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-php">

   // use hook added for getProducts method to apply discount
  	public function onACart_getProducts($products) {
       $discount = $this-&gt;registry-&gt;get(&#39;config&#39;)-&gt;get(&#39;discount_percent&#39;);
       foreach ( $products as $key =&gt; $p ) {
           $products[$key][&#39;original_price&#39;] = $p[&#39;price&#39;];
           $products[$key][&#39;original_total&#39;] = $p[&#39;total&#39;];
           $products[$key][&#39;price&#39;] = $p[&#39;price&#39;] - $p[&#39;price&#39;] * $discount / 100;
           $products[$key][&#39;total&#39;] = $p[&#39;total&#39;] - $p[&#39;total&#39;] * $discount / 100;
   	}
	}
	</code>
 	</pre>
</div>
<!-- HTML Highlight -->
	
	
	
<p>3. edit <b>storefront\controller\checkout\cart.php</b>
add these lines
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-php">
//use to update product data before render
$this-&gt;extensions-&gt;do_UpdateProduct($this, $result);
 
after
$this-&gt;data[&#39;product&#39;] = array(
.....
);
 	</code>
 	</pre>
</div>
<!-- HTML Highlight -->






<p>4. edit <b>extensions\discount\core\discount.php</b>
</p><p>Use updateData hook. Each controller has this hook and can update its data before render output
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-php">
public function onControllerPagesCheckoutCart_UpdateData() {
   	$controller = $this-&gt;baseObject;
  	   $products = $this-&gt;registry-&gt;get(&#39;cart&#39;)-&gt;getProducts();
   	$data = $controller-&gt;view-&gt;getData();
  	   $currency = $this-&gt;registry-&gt;get(&#39;currency&#39;);
  	   $tax = $this-&gt;registry-&gt;get(&#39;tax&#39;);
  	   $config_tax = $this-&gt;registry-&gt;get(&#39;config&#39;)-&gt;get(&#39;config_tax&#39;);
  	 foreach ( $data[&#39;products&#39;] as $key =&gt; $p ) {
       	$product = $products[$p[&#39;key&#39;]];
  	       $data[&#39;products&#39;][$key][&#39;discount_product_message&#39;] = sprintf(
              	   $this-&gt;registry-&gt;get(&#39;config&#39;)-&gt;get(&#39;discount_product_message&#39;),
              	   $currency-&gt;format($tax-&gt;calculate($product[&#39;original_price&#39;], $product[&#39;tax_class_id&#39;], $config_tax)),
              	   $currency-&gt;format($tax-&gt;calculate($product[&#39;original_price&#39;] - $product[&#39;price&#39;], $product[&#39;tax_class_id&#39;], $config_tax))
        	   );
   	}
 
   	$controller-&gt;view-&gt;assign(&#39;products&#39;, $data[&#39;products&#39;]);
 
  	}
	</code>
 	</pre>
</div>
<!-- HTML Highlight -->





<p>5. edit <b>extensions/discount/storefront/view/default/template/pages/checkout/cart.tpl</b>
</p><p>Find
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-php">
&lt;?php foreach ($products as $product) { ?&gt;
....
&lt;?php } ?&gt;
 	</code>
 	</pre>
</div>
<!-- HTML Highlight -->


<p><br> 
And insert before &lt;?php }&nbsp;?&gt;
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
&lt;tr&gt;
   &lt;td colspan=&quot;7&quot; align=&quot;center&quot;&gt;
&lt;?php echo $product[&#39;discount_product_message&#39;]; ?&gt;
  &lt;/td&gt;
&lt;/tr&gt;
 	</code>
 	</pre>
</div>
<!-- HTML Highlight -->
	
	
	</div>
	
	
	
	
	
	
	
	
	
	
	
	






<div class="category-info helper">
	<h4 id="additional" class="box-title">Additional scripts and styles for extensions</h4>
	<p class="box-description">
All styles and scripts loaded in head controller. It use <b>document</b> class. If your extension need to load style/script use <b>document</b> class
</p><p>To add stylesheet  use
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-php">
public function addStyle(array($href, $rel = &#39;stylesheet&#39;, $media = &#39;screen&#39;))</code>
 	</pre>
</div>
<!-- HTML Highlight -->	
<p>To add script use
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-php">
public function addScript($script)
 	</code>
 	</pre>
</div>
<!-- HTML Highlight -->


<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-php">
//For example you need to add css and js
// RDIR_TEMPLATE - points to template directory
$document = $registry-&gt;get(‘document’);
$document-&gt;addStyle(array(RDIR_TEMPLATE.&#39;stylesheet/some.css&#39;));
$document-&gt;addScript(RDIR_TEMPLATE.&#39;javascript/some.js&#39;);
 
// in controller you can use this
$this-&gt;document-&gt;addStyle(array(RDIR_TEMPLATE.&#39;stylesheet/some.css&#39;));
$this-&gt;document-&gt;addScript(RDIR_TEMPLATE.&#39;javascript/some.js&#39;);</code>
 	</pre>
</div>
<!-- HTML Highlight -->
	
</div>










<div class="category-info helper">
	<h4 id="rl" class="box-title">Resource Library</h4>
	<p class="box-description">
	To manage resources use resource library.  It is designed to
</p>
<ul><li> upload files
</li><li> add resource code ( youtube html, image html etc )
</li><li> manage resources
</li><li> assign resources to different objects like products, manufacturers, categories, downloads etc
</li></ul>
<p>We have following resource types
</p>
<ul><li> image
</li><li> audio
</li><li> video
</li><li> pdf
</li><li> archive
</li></ul>
		
</div>









<div class="category-info helper">
	<h4 id="rlexample" class="box-title">Example of extension that use resource library</h4>
	<p class="box-description">
	We will create slideshow extension.  It will have following features:
</p>
<ul><li> manage slides
</li><li> slides will use image resources from resource library
</li><li> add block to layout
</li><li> example of how to add styles/scripts that needed for extension
</li></ul>
<p>Here we will have a part of extension source. You can take a look at full code by downloading our free template. This extension is a part of template.
</p><p>-          create <b>extensions/slideshow</b> folder
-          create <b>extensions/slideshow/config.xml</b>
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-markup">
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;extension&gt;
  	&lt;id&gt;slideshow&lt;/id&gt;
  	&lt;version&gt;1.0&lt;/version&gt;
  	&lt;cartversions&gt;
        	&lt;item&gt;0.9&lt;/item&gt;
        &lt;item&gt;1.0&lt;/item&gt;
  	&lt;/cartversions&gt;
  	&lt;priority&gt;30&lt;/priority&gt;
  	&lt;type&gt;extension&lt;/type&gt;
  	&lt;category&gt;blocks&lt;/category&gt;
  	&lt;settings&gt;
        	&lt;item id=&quot;slideshow_status&quot;&gt;
              	&lt;type&gt;checkbox&lt;/type&gt;
              	&lt;default_value&gt;0&lt;/default_value&gt;
        	&lt;/item&gt;
        	&lt;item id=&quot;slideshow_x&quot;&gt;
              	&lt;type&gt;input&lt;/type&gt;
              	&lt;default_value&gt;544&lt;/default_value&gt;
        	&lt;/item&gt;
        	&lt;item id=&quot;slideshow_y&quot;&gt;
              	&lt;type&gt;input&lt;/type&gt;
              	&lt;default_value&gt;305&lt;/default_value&gt;
        	&lt;/item&gt;
  	&lt;/settings&gt;
  	&lt;additional_settings&gt;&lt;![CDATA[blocks/slideshow]]&gt;&lt;/additional_settings&gt;
  	&lt;note&gt;true&lt;/note&gt;
  	&lt;install&gt;
        	&lt;sql&gt;install.sql&lt;/sql&gt;
        	&lt;trigger&gt;install.php&lt;/trigger&gt;
  	&lt;/install&gt;
  	&lt;uninstall&gt;
        &lt;sql&gt;uninstall.sql&lt;/sql&gt;
        	&lt;trigger&gt;uninstall.php&lt;/trigger&gt;
  	&lt;/uninstall&gt;
&lt;/extension&gt;
</code>
 	</pre>
</div>
<!-- HTML Highlight -->

<p>In config we define size of slide ( slideshow_x, slideshow_y )
&lt;additional_settings&gt; tag define link for extension controller that will manage slides
&lt;note&gt;true&lt;/note&gt; - mean that will have description note for extension that will be shown on extension edit page. Note text is defined in language file with definition key = <b>slideshow_note</b>
</p><p>-          create <b>install.sql</b>. Table will keep slide img and slide url
</p>
<!-- HTML Highlight -->
<div class="code-highlight">
	<span class="js-copy-to-clipboard copy-code">copy</span> <pre><code class="language-sql">
CREATE TABLE IF NOT EXISTS `ac_slides` (
  	`slide_id` int(11) NOT NULL AUTO_INCREMENT,
  	`slide_img` varchar(128) COLLATE utf8_bin NOT NULL DEFAULT &#39;&#39;,
  	`slide_url` varchar(128) COLLATE utf8_bin NOT NULL DEFAULT &#39;&#39;,
  	PRIMARY KEY (`slide_id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_bin AUTO_INCREMENT=1;
 
INSERT INTO `ac_slides` ( `slide_img`, `slide_url` ) VALUES ( &#39;slides/slide1.jpg&#39;, &#39;http://google.com&#39; );
INSERT INTO `ac_slides` ( `slide_img`, `slide_url` ) VALUES ( &#39;slides/slide2.jpg&#39;, &#39;http://bing.com&#39; );
INSERT INTO `ac_slides` ( `slide_img`, `slide_url` ) VALUES ( &#39;slides/slide3.jpg&#39;, &#39;http://msn.com&#39; );</code>
 	</pre>
</div>
<!-- HTML Highlight -->
	
	
	
	
	
	
	
</div>